(function(P,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(P=typeof globalThis<"u"?globalThis:P||self,t(P.VueResizablePanels={},P.Vue))})(this,function(P,t){"use strict";const N=Symbol("PanelGroupContext");let k=0;function $(l){return l||(k++,`vue-resizable-panels:${k}`)}const F=t.defineComponent({__name:"Panel",props:{id:{},className:{default:""},collapsedSize:{default:0},collapsible:{type:Boolean,default:!1},defaultSize:{},maxSize:{},minSize:{},onCollapse:{},onExpand:{},onResize:{},order:{},style:{},tagName:{default:"div"}},emits:["collapse","expand","resize"],setup(l,{expose:o,emit:e}){const i=l,a=e,c=t.inject(N);if(!c)throw new Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:s,expandPanel:d,getPanelSize:f,getPanelStyle:E,isPanelCollapsed:y,reevaluatePanelConstraints:m,registerPanel:u,resizePanel:x,unregisterPanel:S}=c,g=$(i.id),r=t.ref({callbacks:{onCollapse:()=>a("collapse"),onExpand:()=>a("expand"),onResize:(v,L)=>a("resize",v,L)},constraints:{collapsedSize:i.collapsedSize,collapsible:i.collapsible,defaultSize:i.defaultSize,maxSize:i.maxSize,minSize:i.minSize},id:g,idIsFromProps:i.id!==void 0,order:i.order}),n=t.computed(()=>{const v=f(r.value);return console.log(`Panel ${g} size:`,v),v}),p=t.computed(()=>y(r.value)),z=t.computed(()=>{const v=E(r.value,i.defaultSize);return console.log(`Panel ${g} style:`,v),{...v,...i.style}});return t.watch(()=>({collapsedSize:i.collapsedSize,collapsible:i.collapsible,maxSize:i.maxSize,minSize:i.minSize}),v=>{const L={...r.value.constraints};r.value.constraints.collapsedSize=v.collapsedSize,r.value.constraints.collapsible=v.collapsible,r.value.constraints.maxSize=v.maxSize,r.value.constraints.minSize=v.minSize,(L.collapsedSize!==v.collapsedSize||L.collapsible!==v.collapsible||L.maxSize!==v.maxSize||L.minSize!==v.minSize)&&m(r.value,L)},{deep:!0}),t.onMounted(()=>{u(r.value)}),t.onUnmounted(()=>{S(r.value)}),o({collapse:()=>s(r.value),expand:v=>d(r.value,v),getId:()=>g,getSize:()=>f(r.value),isCollapsed:()=>p.value,isExpanded:()=>!y(r.value),resize:v=>x(r.value,v)}),(v,L)=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(v.tagName),{class:t.normalizeClass(v.className),style:t.normalizeStyle(z.value),"data-panel":!0,"data-panel-id":t.unref(g),"data-panel-size":n.value,"data-panel-collapsible":v.collapsible||void 0,"data-panel-collapsed":p.value||void 0},{default:t.withCtx(()=>[t.renderSlot(v.$slots,"default")]),_:3},8,["class","style","data-panel-id","data-panel-size","data-panel-collapsible","data-panel-collapsed"]))}});function D(l,o){if(!l)throw new Error(o||"Assertion failed")}const G=5;function w(l,o,e=G){const i=parseFloat(l.toFixed(e)),a=parseFloat(o.toFixed(e));return i<a?-1:i>a?1:0}function b(l,o,e=G){return w(l,o,e)===0}function B(l,o){if(l.length!==o.length)return!1;for(let e=0;e<l.length;e++)if(!b(l[e],o[e]))return!1;return!0}function _({panelConstraints:l,panelIndex:o,size:e}){const{collapsedSize:i=0,collapsible:a,maxSize:c=100,minSize:s=0}=l[o]??{};return a&&b(e,i)?i:e<s?s:e>c?c:e}function M({panelConstraints:l,panelIndex:o,size:e}){return _({panelConstraints:l,panelIndex:o,size:e})}function H({delta:l,initialLayout:o,panelConstraints:e,pivotIndices:i,prevLayout:a,trigger:c}){if(b(l,0))return o;const s=[...o],[d,f]=i;D(d!=null,"Invalid first pivot index"),D(f!=null,"Invalid second pivot index");let E=0;if(c==="keyboard"){{const m=l<0?f:d,u=e[m];D(u,`Panel constraints not found for index ${m}`);const{collapsedSize:x=0,collapsible:S,minSize:g=0}=u;if(S){const r=o[m];if(D(r!=null,`Previous layout not found for panel index ${m}`),b(r,x)){const n=g-r;w(n,Math.abs(l))>0&&(l=l<0?0-n:n)}}}{const m=l<0?d:f,u=e[m];D(u,`No panel constraints found for index ${m}`);const{collapsedSize:x=0,collapsible:S,minSize:g=0}=u;if(S){const r=o[m];if(D(r!=null,`Previous layout not found for panel index ${m}`),b(r,g)){const n=r-x;w(n,Math.abs(l))>0&&(l=l<0?0-n:n)}}}}{const m=l<0?1:-1;let u=l<0?f:d,x=0;for(;;){const g=o[u];D(g!=null,`Previous layout not found for panel index ${u}`);const n=M({panelConstraints:e,panelIndex:u,size:100})-g;if(x+=n,u+=m,u<0||u>=e.length)break}const S=Math.min(Math.abs(l),Math.abs(x));l=l<0?0-S:S}{let u=l<0?d:f;for(;u>=0&&u<e.length;){const x=Math.abs(l)-Math.abs(E),S=o[u];D(S!=null,`Previous layout not found for panel index ${u}`);const g=S-x,r=M({panelConstraints:e,panelIndex:u,size:g});if(!b(S,r)&&(E+=S-r,s[u]=r,E.toPrecision(3).localeCompare(Math.abs(l).toPrecision(3),void 0,{numeric:!0})>=0))break;l<0?u--:u++}}if(B(a,s))return a;{const m=l<0?f:d,u=o[m];D(u!=null,`Previous layout not found for panel index ${m}`);const x=u+E,S=M({panelConstraints:e,panelIndex:m,size:x});if(s[m]=S,!b(S,x)){let g=x-S,n=l<0?f:d;for(;n>=0&&n<e.length;){const p=s[n];D(p!=null,`Previous layout not found for panel index ${n}`);const z=p+g,h=M({panelConstraints:e,panelIndex:n,size:z});if(b(p,h)||(g-=h-p,s[n]=h),b(g,0))break;l>0?n--:n++}}}const y=s.reduce((m,u)=>u+m,0);return b(y,100)?s:a}function U(l,o,e,i){const a=i.getBoundingClientRect(),c=o==="horizontal",s=c?l.clientX:l.clientY,d=c?a.width:a.height;return(s-e)/d*100}function j({panelDataArray:l}){const o=Array(l.length),e=[];let i=0;for(let a=0;a<l.length;a++){const c=l[a],{defaultSize:s}=c.constraints;s!=null?(o[a]=s,i+=s):e.push(a)}if(e.length>0){const a=100-i,c=Math.max(0,a/e.length);for(const s of e)o[s]=c}return o}function X({defaultSize:l,dragState:o,layout:e,panelData:i,panelIndex:a,precision:c=3}){const s=e[a];let d;return s==null?d=l!=null?l.toPrecision(c):"1":i.length===1?d="1":d=s.toPrecision(c),{flexBasis:0,flexGrow:d,flexShrink:1,overflow:"hidden",pointerEvents:o!==null?"none":void 0}}function Y(l,o=document){return Array.from(o.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${l}"]`))}function A(l,o,e=document){const a=Y(l,e).findIndex(c=>c.getAttribute("data-panel-resize-handle-id")===o);return a>=0?a:null}function T(l,o,e){const i=A(l,o,e);return i!=null?[i,i+1]:[-1,-1]}function O(l,o){const e=l==="horizontal";return"clientX"in o&&"clientY"in o?e?o.clientX:o.clientY:0}function V({layout:l,panelConstraints:o}){const e=[...l];let i=0;for(let a=0;a<e.length;a++){const c=e[a],s=M({panelConstraints:o,panelIndex:a,size:c});e[a]=s,i+=s}if(!b(i,100))for(let a=0;a<e.length;a++)e[a]=e[a]/i*100;return e}const K=t.defineComponent({__name:"PanelGroup",props:{id:{},direction:{},className:{default:""},style:{default:()=>({})},tagName:{default:"div"},keyboardResizeBy:{default:null},onLayout:{}},emits:["layout"],setup(l,{emit:o}){const e=l,i=o,a=$(e.id),c=t.ref(),s=t.ref(null),d=t.ref([]),f=t.ref([]),E=t.computed(()=>({display:"flex",flexDirection:e.direction==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%",...e.style})),y=(n,p)=>{if(console.log("Starting drag for handle:",n),!c.value)return;const z=c.value.querySelector(`[data-panel-resize-handle-id="${n}"]`);if(!z){console.error(`Drag handle element not found for id "${n}"`);return}const h=O(e.direction,p);s.value={dragHandleId:n,dragHandleRect:z.getBoundingClientRect(),initialCursorPosition:h,initialLayout:[...d.value]},console.log("Drag state set:",s.value),x()},m=()=>{s.value=null},u=n=>{if(!s.value||!c.value)return;console.log("Mouse move during drag");const{initialCursorPosition:p,initialLayout:z,dragHandleId:h}=s.value,C=U({clientX:n.clientX,clientY:n.clientY},e.direction,p,c.value);console.log("Delta percentage:",C);const R=T(a,h,c.value);if(console.log("Pivot indices:",R),R[0]===-1||R[1]===-1){console.warn("无法找到有效的panel索引，停止拖拽处理");return}const I=H({delta:C,initialLayout:z,panelConstraints:f.value.map(q=>q.constraints),pivotIndices:R,prevLayout:d.value,trigger:"mouse-or-touch"});console.log("Next layout:",I),B(d.value,I)||(d.value=I,e.onLayout&&e.onLayout(I),i("layout",I))},x=()=>{console.log("🎯 Adding global event listeners"),document.addEventListener("mousemove",u),document.addEventListener("mouseup",g),console.log("✅ Global event listeners added")},S=()=>{console.log("🧹 Removing global event listeners"),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",g),console.log("✅ Global event listeners removed")},g=()=>{console.log("🛑 Stopping drag and cleanup"),m(),S()},r=t.reactive({collapsePanel:n=>{console.log("collapsePanel",n)},get direction(){return e.direction},get dragState(){return s.value},expandPanel:(n,p)=>{console.log("expandPanel",n,p)},getPanelSize:n=>{const p=f.value.findIndex(z=>z.id===n.id);return d.value[p]||0},getPanelStyle:(n,p)=>{const z=f.value.findIndex(h=>h.id===n.id);return X({defaultSize:p,dragState:s.value,layout:d.value,panelData:f.value,panelIndex:z})},groupId:a,handleResizeDrag:(n,p)=>{if(!s.value){y(n,p);return}u(p)},isPanelCollapsed:n=>!1,isPanelExpanded:n=>!r.isPanelCollapsed(n),reevaluatePanelConstraints:(n,p)=>{console.log("reevaluatePanelConstraints",n,p)},registerPanel:n=>{f.value.push(n),f.value.sort((h,C)=>{const R=h.order,I=C.order;return R==null&&I==null?0:R==null?-1:I==null?1:R-I});const p=j({panelDataArray:f.value}),z=V({layout:p,panelConstraints:f.value.map(h=>h.constraints)});B(d.value,z)||(d.value=z,e.onLayout&&e.onLayout(z),i("layout",z))},resizePanel:(n,p)=>{const z=f.value.findIndex(h=>h.id===n.id);z!==-1&&(d.value[z]=p)},startDragging:y,stopDragging:g,unregisterPanel:n=>{const p=f.value.findIndex(z=>z.id===n.id);if(p!==-1){if(f.value.splice(p,1),d.value.splice(p,1),f.value.length>0){const z=d.value.reduce((h,C)=>h+C,0);if(z<100){const h=(100-z)/d.value.length;d.value=d.value.map(C=>C+h)}}e.onLayout&&e.onLayout(d.value),i("layout",d.value)}},get panelGroupElement(){return c.value||null}});return t.provide(N,r),(n,p)=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(n.tagName),{ref_key:"panelGroupElementRef",ref:c,class:t.normalizeClass(n.className),style:t.normalizeStyle(E.value),"data-panel-group":!0,"data-panel-group-direction":n.direction,"data-panel-group-id":t.unref(a)},{default:t.withCtx(()=>[t.renderSlot(n.$slots,"default")]),_:3},8,["class","style","data-panel-group-direction","data-panel-group-id"]))}}),W=t.defineComponent({__name:"PanelResizeHandle",props:{id:{},className:{default:""},disabled:{type:Boolean,default:!1},style:{default:()=>({})},tabIndex:{default:0},tagName:{default:"div"}},emits:["blur","focus","dragging","pointerDown","pointerUp","click"],setup(l,{emit:o}){const e=l,i=o,a=t.inject(N);if(!a)throw new Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:c,groupId:s}=a,d=t.ref(),f=$(e.id),E=t.ref(!1),y=t.ref(!1),m=t.computed(()=>({touchAction:"none",userSelect:"none",cursor:c==="horizontal"?"col-resize":"row-resize",...e.style})),u=()=>{E.value=!1,i("blur")},x=()=>{E.value=!0,i("focus")},S=n=>{e.disabled||(console.log("🖱️ Mouse down on resize handle:",f),n.preventDefault(),y.value=!0,a.startDragging&&a.startDragging(f,n),document.addEventListener("mousemove",g,{passive:!1}),document.addEventListener("mouseup",r,{passive:!1}),console.log("🎯 Started dragging, added global listeners"),i("pointerDown"),i("dragging",!0))},g=n=>{y.value&&(console.log("🖱️ Mouse move during drag"),n.preventDefault(),a.handleResizeDrag&&a.handleResizeDrag(f,n))},r=n=>{y.value&&(console.log("🖱️ Mouse up, ending drag"),n.preventDefault(),y.value=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",r),console.log("🧹 Ended dragging, removed global listeners"),i("pointerUp"),i("dragging",!1))};return t.onMounted(()=>{console.log("PanelResizeHandle mounted:",f)}),t.onUnmounted(()=>{y.value&&(document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",r))}),(n,p)=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(n.tagName),{ref_key:"elementRef",ref:d,class:t.normalizeClass(n.className),style:t.normalizeStyle(m.value),tabindex:n.disabled?void 0:n.tabIndex,"data-panel-resize-handle":!0,"data-panel-resize-handle-id":t.unref(f),"data-panel-resize-handle-enabled":!n.disabled||void 0,"data-panel-resize-handle-disabled":n.disabled||void 0,"data-panel-group-direction":t.unref(c),"data-panel-group-id":t.unref(s),role:"separator",onBlur:u,onFocus:x,onMousedown:S},{default:t.withCtx(()=>[t.renderSlot(n.$slots,"default")]),_:3},40,["class","style","tabindex","data-panel-resize-handle-id","data-panel-resize-handle-enabled","data-panel-resize-handle-disabled","data-panel-group-direction","data-panel-group-id"]))}});function J(l,o){if(l.length!==o.length)return!1;for(let e=0;e<l.length;e++)if(l[e]!==o[e])return!1;return!0}P.Panel=F,P.PanelGroup=K,P.PanelResizeHandle=W,P.areEqual=J,P.assert=D,P.fuzzyCompareNumbers=w,P.fuzzyNumbersEqual=b,Object.defineProperty(P,Symbol.toStringTag,{value:"Module"})});
